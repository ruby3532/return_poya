# 寶雅 WMS 進倉單自動化工具

這是一個自動化工具，用於從 WMS 系統抓取進倉單資料並轉換為標準 CSV 格式，方便後續處理和匯入。

## 🎯 功能特色

- 🤖 自動登入 WMS 系統
- 📊 自動抓取進倉單詳細資料
- 📄 轉換為標準 CSV 格式
- 🔧 支援多種進倉單號格式
- 📧 可選的 Email 發送功能

## 📋 系統需求

- Node.js 18 或更高版本
- 有效的 WMS 系統帳號
- 網路連線

## 🚀 安裝步驟

### 1. 安裝依賴套件

```bash
npm install
```

### 2. 安裝 Playwright 瀏覽器

```bash
npx playwright install chromium
```

### 3. 設定環境變數

複製環境變數模板檔案：
```bash
cp env.example .env
```

編輯 `.env` 檔案，填入您的帳號資訊：
```env
# WMS 登入資訊
WMS_USER=您的WMS帳號
WMS_PASS=您的WMS密碼

# Email 設定 (可選)
EMAIL_USER=您的Gmail
EMAIL_PASS=您的Gmail App Password
EMAIL_TO=收件人Gmail
```

## 📖 使用方法

### 基本用法

```bash
node index.js <進倉單號>
```

### 範例

```bash
# 處理進倉單號 RVN00003508
node index.js RVN00003508

# 處理其他進倉單號
node index.js ABC123456
```

## 📊 輸出格式

程式會產生包含以下欄位的 CSV 檔案：

| 欄位 | 說明 | 範例值 | 必填 |
|------|------|--------|------|
| 通路/平台* | 固定值 | 實體-寶雅 | ✅ |
| 是否入庫* | 固定值 | 是 | ✅ |
| 入庫倉庫* | 固定值 | 藍田 | ✅ |
| 退貨單號/黑貓訂單* | 進倉單號 | RVN00003508 | ✅ |
| 退件人* | 固定值 | 實體-寶雅 | ✅ |
| 退貨單備註 | 進倉單號 | RVN00003508 | ✅ |
| sku(品號)* | 商品SKU | 9319133336544 | ✅ |
| 數量* | 商品數量 | 2 | ✅ |
| 退貨原因* | 固定值 | 客人個人因素 | ✅ |
| 系統訂單編號 | 系統訂單編號 | (空白) | ❌ |
| 退件人電話 | 退件人聯絡電話 | (空白) | ❌ |
| 郵遞區號 | 退件地址郵遞區號 | (空白) | ❌ |
| 退件人地址 | 退件人完整地址 | (空白) | ❌ |
| 逆物流編號 | 逆物流追蹤編號 | (空白) | ❌ |

### CSV 檔案範例

```csv
通路/平台*,是否入庫*,入庫倉庫*,退貨單號/黑貓訂單*,退件人*,退貨單備註,sku(品號)*,數量*,退貨原因*,系統訂單編號,退件人電話,郵遞區號,退件人地址,逆物流編號
實體-寶雅,是,藍田,RVN00003508,實體-寶雅,RVN00003508,澳洲 Carman's 海鹽焦糖大豆蛋白燕麥棒 (35g x 5條),9319133336544,客人個人因素,,,,,
```

**注意**：標記為 ❌ 的欄位為選填項目，預設為空白，可根據需要手動填入。

## 🔧 程式運作流程

1. **登入 WMS 系統**
   - 自動導航到 WMS 登入頁面
   - 使用環境變數中的帳號密碼登入

2. **導航到進倉單詳細頁面**
   - 直接訪問進倉單詳細頁面 URL
   - 等待頁面完全載入

3. **解析表格資料**
   - 尋找 `<table class="table table-striped">` 表格
   - 提取商品資訊（名稱、SKU、數量等）

4. **生成 CSV 檔案**
   - 將資料轉換為標準 CSV 格式
   - 檔案命名：`wms_<進倉單號>.csv`

5. **Email 發送**（可選）
   - 將 CSV 檔案作為附件發送
   - 收件人：`ruby.lee@urmart.com`

## 📁 專案結構

```
poya_back/
├── index.js              # 主程式檔案
├── package.json          # 專案配置
├── env.example           # 環境變數模板
├── README.md            # 使用說明
├── .env                 # 環境變數檔案（需自行建立）
├── node_modules/        # 依賴套件
└── wms_*.csv           # 生成的 CSV 檔案
```

## ⚠️ 注意事項

### WMS 系統
- 確保 WMS 帳號有足夠的權限訪問進倉單資料
- 進倉單號必須存在於系統中
- 網路連線必須穩定

### Email 設定（可選）
- 如果使用 Gmail，需要啟用兩步驟驗證
- 需要設定 App Password 而非一般密碼
- 目前 Email 功能預設為關閉狀態

### 檔案管理
- CSV 檔案會保留在專案目錄中
- 建議定期清理舊的 CSV 檔案
- 檔案命名格式：`wms_<進倉單號>.csv`

## 🐛 常見問題

### Q: 程式無法登入 WMS 系統
A: 請檢查：
- 環境變數設定是否正確
- WMS 帳號密碼是否有效
- 網路連線是否正常

### Q: 找不到進倉單資料
A: 請確認：
- 進倉單號是否正確
- 進倉單是否存在於系統中
- 帳號是否有權限查看該進倉單

### Q: CSV 檔案格式不正確
A: 請檢查：
- WMS 系統頁面結構是否改變
- 表格資料是否完整
- 程式版本是否最新

### Q: Email 發送失敗
A: 請確認：
- Gmail 帳號設定是否正確
- App Password 是否有效
- 網路連線是否穩定

## 🔄 更新日誌

### v1.0.0 (2024-12-19)
- ✅ 初始版本發布
- ✅ 支援 WMS 系統自動登入
- ✅ 支援進倉單資料抓取
- ✅ 支援 CSV 格式輸出
- ✅ 支援 Email 發送功能

## 📞 技術支援

如有問題或建議，請聯繫：
- 開發者：AI Assistant
- 專案位置：`/Users/lixinru/Desktop/poya_back`

## 📄 授權

MIT License - 可自由使用、修改和分發

---

**注意**：此工具僅供內部使用，請勿用於商業用途或分發給第三方。